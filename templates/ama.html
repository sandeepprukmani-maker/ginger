{% extends "base.html" %}

{% block title %}Ask Me Anything - iDraft{% endblock %}

{% block header_title %}
<h1 class="page-title">Ask Me Anything</h1>
{% endblock %}

{% block content %}
<div class="ama-container">
    <div class="ama-sidebar">
        <div class="stats-card">
            <h3 class="stats-title">
                <i class="bi bi-database-fill"></i> Knowledge Base
            </h3>
            <div class="stat-item">
                <span class="stat-label">Project Documents</span>
                <span class="stat-value" id="projectDocsCount">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Conversations</span>
                <span class="stat-value" id="conversationsCount">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Validated Answers</span>
                <span class="stat-value" id="validatedCount">0</span>
            </div>
        </div>

        <div class="info-card mt-3">
            <h4><i class="bi bi-info-circle-fill"></i> How it works</h4>
            <ul class="info-list">
                <li>Ask any question about your project</li>
                <li>AI retrieves relevant context from EPICs, Confluence, and past conversations</li>
                <li>Accept, edit, or reject answers to improve future responses</li>
                <li>System learns from your feedback continuously</li>
            </ul>
        </div>

        <button class="btn-secondary-full mt-3" onclick="indexCurrentEpic()">
            <i class="bi bi-arrow-repeat"></i> Index Current EPIC
        </button>
    </div>

    <div class="ama-main">
        <div class="chat-container" id="chatContainer">
            <div class="chat-welcome" id="chatWelcome">
                <i class="bi bi-chat-dots" style="font-size: 3rem; color: var(--primary-purple); opacity: 0.3;"></i>
                <h3>Start a Conversation</h3>
                <p>Ask me anything about your project, EPICs, user stories, or documentation</p>
            </div>
            <div class="chat-messages" id="chatMessages"></div>
        </div>

        <div class="chat-input-container">
            <div class="input-group-chat">
                <textarea 
                    class="chat-input" 
                    id="questionInput" 
                    placeholder="Ask a question about your project..."
                    rows="1"></textarea>
                <button class="btn-send" onclick="askQuestion()" id="sendBtn">
                    <i class="bi bi-send-fill"></i>
                </button>
            </div>
            <div class="input-hint">
                Press Enter to send, Shift+Enter for new line
            </div>
        </div>
    </div>
</div>

<div id="loadingIndicator" class="loading-overlay" style="display: none;">
    <div class="spinner-modern">
        <div class="spinner-ring"></div>
        <div class="spinner-ring"></div>
        <div class="spinner-ring"></div>
    </div>
    <p class="loading-text">Thinking...</p>
</div>

<div id="alertContainer" class="alert-container"></div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/ama.js') }}"></script>
{% endblock %}
